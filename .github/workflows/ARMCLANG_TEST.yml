name: ARMCLANG_TEST

############################################
# Note: this mus be rewrite as this doesn't work because github actions does not currently provide arm based runners
# Note: Currently the best option is having a self hosted runner (arm based node) on the zoo (zoo is not up and runner as of writing this)
############################################

env:
  ACTIONS_ALLOW_USE_UNSECURE_NODE_VERSION: true
  LLVM-VERSION: 14
  BENCHMARK_BRANCH: 'make-file-build-system' # The branch inside the benchmark repo that has the script to run all benchmarks.

on:
  pull_request:
  

jobs:
  Build_and_Run:
    runs-on: macos-14
    
    strategy:
      fail-fast: false
      matrix:
        # OS: ['ubuntu:18.04','ubuntu:20.04', 'rockylinux:8', 'redhat/ubi8:latest', 'redhat/ubi9:latest', 'debian:10', 'debian:11'] # Docker images
        OS: ['ubuntu:22.04'] # Docker images

    name: "${{ matrix.OS }} + ARMCLANG"
    
    container:
          image: ${{ matrix.OS }}
    steps:
      #######################################
      # Clones repo to workspace.
      #######################################
      - name: checkout v4
        uses: actions/checkout@v4

      - name: INFO
        run: |
          cat /etc/os-release 
          uname -a

      #######################################
      # Depending on OS and compiler, this step chooses the correct setup action to run.
      #######################################
      - name: setup compiler and OS env + build simeng
        uses: ./.github/actions/select_env
        with: 
          LLVM-VERSION: ${{ env.LLVM-VERSION }}
          OS: ubuntu
          COMPILER: armclang

          
